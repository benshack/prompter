"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(t){_defineProperty(e,t,n[t])})}return e}var defaultOptions={interval:0,duration:500,cursor:null,loop:!1,deliminator:null,fps:null,autoplay:!0,endPromptClass:null,startPromptClass:null},prompters=[],listening=!1,wHeight=window.innerHeight,controller={play:function(e){Array.from(prompters).forEach(function(t){(t.elem.classList.contains(e)||t.elem.id===e)&&(t.reset(),t.play())})},stop:function(e){Array.from(prompters).forEach(function(t){(t.elem.classList.contains(e)||t.elem.id===e)&&t.stop()})}},PromptObj=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,i),this.elem=t,this.options=_objectSpread({},defaultOptions,n),this.content=this.parseContent(e),this.span=document.createElement("span"),this.span.style.opacity=0,this.elem.appendChild(this.span),this.reset(),this.initContent(),this.options.autoplay&&this.play()}return _createClass(i,[{key:"play",value:function(){this.running||this.complete||!this.isVisible()||this.prompt()}},{key:"stop",value:function(){this.complete=!0}},{key:"reset",value:function(){this.index=0,this.complete=!1}},{key:"initContent",value:function(){this.elem.innerHTML="",this.string=this.content[this.index],this.string=this.string.split(""),this.span.innerHTML=this.string.join(""),this.elem.appendChild(this.span)}},{key:"prompt",value:function(){var e=this;this.running=!0,this.initContent(),this.options.endPromptClass&&this.elem.classList.remove(this.options.endPromptClass),this.options.startPromptClass&&this.elem.classList.add(this.options.startPromptClass),requestAnimationFrame(function(t){e.frameController(t)}),this.updateIndex()}},{key:"frameController",value:function(t){var e=this;this.start||(this.start=t);var n=t-this.start,i=Math.min(n/this.options.duration,1),s=Math.ceil(linearInterpolation(0,this.string.length,i));if(this.splice||(this.splice=s),this.splice!==s){var r=this.string.slice(0,s),o=this.string.slice(s);r.length<this.string.length&&this.options.cursor&&(r.push(this.options.cursor),o.shift()),this.elem.innerHTML=r.join(""),this.span.innerHTML=o.join(""),this.elem.appendChild(this.span),this.splice=null}i<1?this.options.fps?setTimeout(function(){return requestAnimationFrame(function(t){return e.frameController(t)})},1e3/this.options.fps):requestAnimationFrame(function(t){return e.frameController(t)}):(this.elem.innerHTML=this.string.join(""),this.start=null,this.options.endPromptClass&&this.elem.classList.add(this.options.endPromptClass),this.options.startPromptClass&&this.elem.classList.remove(this.options.startPromptClass),setTimeout(function(){e.running=!1,e.play()},this.options.interval))}},{key:"updateIndex",value:function(){this.index=this.index+1,this.index>=this.content.length&&(this.reset(),this.index=0,this.complete=!this.options.loop)}},{key:"parseContent",value:function(t){if(Array.isArray(t))return t;var e=[];if(t=t||this.elem.innerHTML,this.options.deliminator){var n=t.split(this.options.deliminator);return Array.from(n).forEach(function(t){return e.push(t)}),e}return e.push(t),e}},{key:"isVisible",value:function(){var t=this.elem.getBoundingClientRect();return t.top<wHeight&&0<t.bottom}}]),i}(),initListeners=function(){window.addEventListener("resize",function(){wWidth=window.innerWidth,wHeight=window.innerHeight,playVisible()}),window.addEventListener("scroll",function(){playVisible()})},makePromptObj=function(t,e,n){var i=new PromptObj(t,e,n);prompters.push(i)},playVisible=function(){Array.from(prompters).forEach(function(t){t.options.autoplay&&t.play()})},linearInterpolation=function(t,e,n){return t+(e-t)*n},main=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof t&&(t=document.querySelectorAll("".concat(t))),!(t.length<=0)&&(t?(t.length?Array.from(t).forEach(function(t){makePromptObj(t,e,n)}):makePromptObj(elem,e,n),listening||(initListeners(),listening=!0),controller):void 0)};module.exports=main;
